@page "/person/list"

@using ArborFamiliae.Domain.Person
@inherits BasePageComponent

@inject PersonService PersonService

<h3>@Loc["Persons"]</h3>

<DxButton RenderStyle="ButtonRenderStyle.Primary" Text="@Loc["Add"]" IconCssClass="oi oi-plus" Click="OnAdd"></DxButton>

<DxGrid Data="_personList">
    <Columns>
        <DxGridDataColumn Caption="@Loc["Name"]" FieldName="@nameof(PersonListModel.FullName)"></DxGridDataColumn>
        <DxGridDataColumn Caption="ID" FieldName="@nameof(PersonListModel.ArborId)"></DxGridDataColumn>
        <DxGridDataColumn Caption="@Loc["Gender"]" FieldName="@nameof(PersonListModel.Gender)"></DxGridDataColumn>
        <DxGridDataColumn Caption="@Loc["Birth Date"]" FieldName="@nameof(PersonListModel.BirthDate)"></DxGridDataColumn>
        <DxGridDataColumn Caption="@Loc["Death Date"]" FieldName="@nameof(PersonListModel.DeathDate)"></DxGridDataColumn>
        <DxGridCommandColumn Caption="@Loc["Manage"]">
            <HeaderTemplate Context="detail_context">
                &nbsp;
            </HeaderTemplate>
            <CellDisplayTemplate Context="detail_context">
        	    <a class="oi oi-pencil" style="text-decoration: none;" href="javascript:void(0);" 
        	       @onclick="@(() => NavigationManager.NavigateTo($"/person/{((PersonListModel)detail_context.DataItem).Id}/edit"))"></a>
            </CellDisplayTemplate>
        </DxGridCommandColumn>
    </Columns>
</DxGrid>

@code {

    private List<PersonListModel> _personList;
    
    protected override async Task OnInitializedAsync()
    {
        _personList = await PersonService.GetAllPersons();
    }

    private void OnAdd()
    {
        NavigationManager.NavigateTo("/person/add");
    }
}